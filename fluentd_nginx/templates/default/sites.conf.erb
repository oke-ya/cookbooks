<source>
  type tail
  format /^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)" "(?<forwarder>[^\"]*)") (?<requesttime>[^ ]*)?/
  path /var/log/nginx/<%= @application %>.log
  pos_file /var/log/td-agent/nginx-<%= @application %>-log.pos
  tag nginx.access
</source>

<match nginx.access>
  type s3
  aws_key_id <%= @aws_key_id %>
  aws_sec_key <%= @aws_sec_key %>
  s3_bucket <%= @s3_bucket %>
  s3_endpoint <%= @s3_end_point %>
  path logs/
  buffer_path /var/log/td-agent/s3
  time_slice_format %Y%m%d/ip-%H
  time_slice_wait 10m
  #flush_interval 5s
</match>