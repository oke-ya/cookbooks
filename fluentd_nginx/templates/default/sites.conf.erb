<source>
  type tail
  format /(?<addr>[^ ]*) - (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>[^ ]*) (?<path>[^\?]*)\?opensocial_app_id=(?<app_id>[^&]*)&opensocial_viewer_id=(?<viewer_id>[^&]*)&opensocial_owner_id=(?<owner_id>[^ ]*)(&(?<args>[^ ]*))? (?<http_version>[^ ]*)" (?<status>[^ ]*) (?<body_bytes_sent>[^ ]*) "(?<referer>[^\"]*)" "(?<agent>[^\"]*)"/
  path /var/log/nginx/<%= @application %>.access.log
  pos_file /var/log/td-agent/nginx-<%= @application %>-log.pos
  time_format %d/%b/%Y:%H:%M:%S %z
  tag nginx.access
</source>

<match nginx.access>
  type s3
  aws_key_id <%= @aws_key_id %>
  aws_sec_key <%= @aws_sec_key %>
  s3_bucket <%= @s3_bucket %>
  s3_endpoint <%= @s3_end_point %>
  path logs/
  buffer_path /var/log/td-agent/s3
  time_slice_format %Y%m%d/ip-%H
  time_slice_wait 10m
  #flush_interval 5s
</match>